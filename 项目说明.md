# 🏛️ 校园建筑信息平台项目说明

## 📖 项目概述

这是一个完整的前后端分离的校园建筑信息展示平台，主要功能包括：

1. **用户界面**：浏览建筑信息，查看图片，自动生成介绍和语音
2. **管理后台**：添加、删除建筑信息，上传图片
3. **AI功能**：集成DashScope API的建筑介绍生成和Java文字转语音

## 🎯 核心功能

### ✅ 已实现功能
- ✅ 建筑信息数据库（SQLite，删除经纬度字段）
- ✅ 建筑列表展示
- ✅ 建筑详情页面
- ✅ 管理后台界面
- ✅ 图片上传功能
- ✅ 建筑信息增删操作
- ✅ 响应式设计
- ✅ DashScope API集成（建筑介绍生成）
- ✅ Java TTS集成（文字转语音）

### 🔄 主要变更
- 🔄 删除经纬度字段
- 🔄 自动生成建筑介绍（无需点击按钮）
- 🔄 集成真实的DashScope API
- 🔄 集成Java文字转语音功能

## 🚀 快速启动

### 环境准备
确保系统已安装：
- Node.js (版本 14+)
- Java (版本 8+)
- Maven

### 配置步骤

1. **配置环境变量**
```bash
cd backend
cp env.example .env
# 编辑 .env 文件，填入您的API密钥
```

2. **构建Java TTS程序**
```bash
cd backend/java
./build.sh
```

3. **启动项目**
```bash
# 方式一：使用启动脚本（推荐）
./start.sh

# 方式二：手动启动
npm run install-all
cd backend && npm run init-db && cd ..
npm run dev
```

启动后访问：
- 前端：http://localhost:3000
- 后端：http://localhost:5000

## 📂 文件结构说明

```
tianchi/
├── backend/                    # 后端服务器
│   ├── java/                  # Java TTS程序
│   │   ├── TextToSpeech.java  # TTS主程序
│   │   ├── pom.xml           # Maven配置
│   │   └── build.sh          # 构建脚本
│   ├── routes/buildings.js    # 建筑API路由
│   ├── scripts/initDatabase.js # 数据库初始化
│   ├── server.js              # 服务器主文件
│   ├── database/              # 数据库文件目录
│   ├── uploads/               # 图片和音频上传目录
│   └── .env                   # 环境变量配置
│
├── frontend/                   # 前端应用
│   ├── src/
│   │   ├── components/        # React组件
│   │   │   ├── BuildingSelector.tsx  # 建筑选择器
│   │   │   ├── BuildingDetails.tsx   # 建筑详情（自动生成介绍）
│   │   │   └── AdminPanel.tsx        # 管理后台（删除经纬度）
│   │   ├── types/Building.ts         # 类型定义（删除经纬度）
│   │   └── App.tsx                   # 主应用
│   └── package.json
│
├── package.json                # 根package.json
├── start.sh                   # 启动脚本
└── README.md                  # 项目文档
```

## 🔌 API接口说明

### 建筑信息接口
| 方法 | 路径 | 说明 | 参数 |
|------|------|------|------|
| GET | `/api/buildings` | 获取所有建筑 | 无 |
| GET | `/api/buildings/:id` | 获取单个建筑 | id |
| POST | `/api/buildings` | 添加建筑 | FormData（删除经纬度） |
| DELETE | `/api/buildings/:id` | 删除建筑 | id |

### AI功能接口
| 方法 | 路径 | 说明 | 状态 |
|------|------|------|------|
| POST | `/api/generate-description` | 生成建筑介绍 | ✅ 已集成DashScope |
| POST | `/api/text-to-speech` | 文字转语音 | ✅ 已集成Java TTS |

## 🛠️ 技术实现详情

### 1. DashScope API集成
- **功能**：自动生成建筑介绍
- **触发**：选择建筑时自动调用
- **提示词**：校长身份，温和语气，150-300字
- **配置**：需要 `DASHSCOPE_API_KEY` 和 `DASHSCOPE_APP_ID`

### 2. Java TTS集成
- **功能**：将建筑介绍转换为语音
- **音色**：固定音色ID `cosyvoice-clone-v1-prefix-f7310bf44f02466ca27000c32e96b033`
- **格式**：生成MP3音频文件
- **存储**：保存到 `backend/uploads/audio/` 目录

### 3. 数据库变更
- **删除字段**：latitude（纬度）、longitude（经度）
- **保留字段**：id、name、image_url、address、created_at
- **示例数据**：更新为校园建筑（图书馆、行政楼等）

## 📋 使用说明

### 用户界面
1. 打开网站后，默认显示用户界面
2. 点击建筑卡片查看详情
3. **自动生成介绍**：选择建筑后自动调用AI生成介绍
4. **语音播放**：点击"文字转语音"按钮生成并播放语音

### 管理后台
1. 点击顶部"管理后台"切换到管理界面
2. 填写建筑信息：
   - 建筑名称（必填）
   - 地址（必填）
   - 上传建筑图片（可选）
3. 点击"添加建筑"保存
4. 在建筑列表中可以删除不需要的建筑

## 🔍 环境变量配置

在 `backend/.env` 文件中配置：

```bash
# DashScope API配置
DASHSCOPE_API_KEY=your_dashscope_api_key_here
DASHSCOPE_APP_ID=your_app_id_here

# 服务器配置
PORT=5000
```

## ⚠️ 注意事项

1. **API密钥**：确保DashScope API密钥和应用ID配置正确
2. **Java环境**：需要Java 8+和Maven环境
3. **构建TTS**：首次使用需要构建Java TTS程序
4. **端口占用**：确保3000和5000端口未被占用
5. **权限管理**：管理后台无身份验证，生产环境需要添加
6. **文件存储**：图片和音频存储在本地，生产环境建议使用云存储

## 🎉 完成状态

✅ 项目架构搭建完成  
✅ 数据库设计完成（删除经纬度）  
✅ 前端界面完成（自动生成介绍）  
✅ 后端API完成  
✅ 图片上传功能完成  
✅ 管理后台完成（删除经纬度字段）  
✅ DashScope API集成完成  
✅ Java TTS集成完成  

项目已经完全可以运行，所有功能都已实现！ 